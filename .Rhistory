sub_study=na.omit(tv_data %>%
select("date",tv.spend,organic,organic.home,direct.home,paid.brand.sessions) %>%
arrange(desc(date)))
sub_study=na.omit(tv_data %>%
select("date","tv.spend","organic","organic.home","direct.home","paid.brand.sessions") %>%
arrange(desc(date)))
study_vars=c("date","tv.spend","organic","organic.home","direct.home","paid.brand.sessions")
study_vars
which(names(tv_data) %in% study_vars)
sub_study=na.omit(tv_data[,study_cols]  %>%                    arrange(desc(date)))
study_cols=which(names(tv_data) %in% study_vars)
sub_study=na.omit(tv_data[,study_cols]  %>%                    arrange(desc(date)))
library(tidyr)
library(dplyr)
library(openxlsx)
library(lubridate)
library(ggplot2)
library(gridExtra)
library(forecast)
library(stats)
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",2))
tv_data$date=as.Date(as.character(tv_data$date),"%m/%d/%Y")+years(2000)
study_vars=c("date","tv.spend","organic","organic.home","direct.home","paid.brand.sessions")
study_cols=which(names(tv_data) %in% study_vars)
sub_study=na.omit(tv_data[,study_cols]  %>% arrange(desc(date)))
sub_study$paid.brand.sessions=as.numeric(as.character(sub_study$paid.brand.sessions))
stl_obj=stl(ts(sub_study$organic, frequency = 2),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Seasonal Decomposition")
ctrl_arima=auto.arima(sub_study$organic)
summary(ctrl_arima)
ctrl_arima_fcast=forecast(ctrl_arima)
plot(ctrl_arima_fcast)
ctrl_arima_R2=round(cor(fitted(ctrl_arima_fcast),sub_study$organic)^2,2)
ctrl_arima_R2
tv_arima=auto.arima(sub_study$organic,xreg=c(sub_study$tv.spend))
summary(tv_arima)
coef(tv_arima)
coef(ctrl_arima)
tv_arima=auto.arima(sub_study$organic,xreg=c(sub_study$tv.spend))
coef(tv_arima)
tv_arima_fcast=forecast(tv_arima,xreg=c(sub_study$tv.spend))
plot(tv_arima_fcast)
tv_arima_R2=round(cor(fitted(tv_arima_fcast),sub_study$organic)^2,2)
tv_arima_R2
stl_obj=stl(ts(sub_study$organic.home, frequency = 2),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Home Seasonal Decomposition")
ctrl_arima=auto.arima(sub_study$organic.home)
ctrl_arima=auto.arima(sub_study$organic.home)
coef(ctrl_arima)
ctrl_arima_fcast=forecast(ctrl_arima)
plot(ctrl_arima_fcast)
ctrl_arima_R2=round(cor(fitted(ctrl_arima_fcast),sub_study$organic.home)^2,2)
ctrl_arima_R2
tv_arima=auto.arima(sub_study$organic.home,xreg=c(sub_study$tv.spend))
coef(tv_arima)
tv_arima_fcast=forecast(tv_arima,xreg=c(sub_study$tv.spend))
plot(tv_arima_fcast)
tv_arima_R2=round(cor(fitted(tv_arima_fcast),sub_study$organic.home)^2,2)
tv_arima_R2
stl_obj=stl(ts(sub_study$direct.home, frequency = 2),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Home Seasonal Decomposition")
ctrl_arima=auto.arima(sub_study$direct.home)
coef(ctrl_arima)
ctrl_arima_fcast=forecast(ctrl_arima)
plot(ctrl_arima_fcast)
ctrl_arima_R2=round(cor(fitted(ctrl_arima_fcast),sub_study$direct.home)^2,2)
ctrl_arima_R2
tv_arima=auto.arima(sub_study$direct.home,xreg=c(sub_study$tv.spend))
coef(tv_arima)
tv_arima_fcast=forecast(tv_arima,xreg=c(sub_study$tv.spend))
plot(tv_arima_fcast)
tv_arima_R2=round(cor(fitted(tv_arima_fcast),sub_study$organic.home)^2,2)
tv_arima_R2
stl_obj=stl(ts(sub_study$paid.brand.sessions, frequency = 2),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Home Seasonal Decomposition")
stl_obj=stl(ts(sub_study$paid.brand.sessions, frequency = 2),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Paid Brand Seasonal Decomposition")
ctrl_arima=auto.arima(sub_study$paid.brand.sessions)
coef(ctrl_arima)
ctrl_arima_fcast=forecast(ctrl_arima)
plot(ctrl_arima_fcast)
ctrl_arima_R2=round(cor(fitted(ctrl_arima_fcast),sub_study$paid.brand.sessions)^2,2)
ctrl_arima_R2
tv_arima=auto.arima(sub_study$paid.brand.sessions,xreg=c(sub_study$tv.spend))
coef(tv_arima)
tv_arima_fcast=forecast(tv_arima,xreg=c(sub_study$tv.spend))
plot(tv_arima_fcast)
tv_arima_R2=round(cor(fitted(tv_arima_fcast),sub_study$paid.brand.sessions)^2,2)
tv_arima_R2
stl_obj=stl(ts(sub_study$direct.home, frequency = 2),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Direct Home Seasonal Decomposition")
ctrl_arima=auto.arima(sub_study$direct.home)
coef(ctrl_arima)
ctrl_arima_fcast=forecast(ctrl_arima)
plot(ctrl_arima_fcast)
ctrl_arima_R2=round(cor(fitted(ctrl_arima_fcast),sub_study$direct.home)^2,2)
ctrl_arima_R2
tv_arima=auto.arima(sub_study$direct.home,xreg=c(sub_study$tv.spend))
coef(tv_arima)
tv_arima_fcast=forecast(tv_arima,xreg=c(sub_study$tv.spend))
plot(tv_arima_fcast)
tv_arima_R2=round(cor(fitted(tv_arima_fcast),sub_study$organic.home)^2,2)
tv_arima_R2
lm(data=sub_study,tv.spend~organic+organic.home+direct.home+paid.brand.sessions)
all_fit=lm(data=sub_study,tv.spend~organic+organic.home+direct.home+paid.brand.sessions)
summary(all_fit)
all_fit=lm(data=sub_study,0+tv.spend~organic+organic.home+direct.home+paid.brand.sessions)
summary(all_fit)
all_fit=lm(data=sub_study,0+tv.spend~organic+organic.home+direct.home+paid.brand.sessions)
summary(all_fit)
all_fit=lm(data=sub_study,1+tv.spend~organic+organic.home+direct.home+paid.brand.sessions)
summary(all_fit)
all_fit=lm(data=sub_study,tv.spend~1+organic+organic.home+direct.home+paid.brand.sessions)
all_fit=lm(data=sub_study,tv.spend~1+organic+organic.home+direct.home+paid.brand.sessions)
cor(sub_study[,sapply(sub_study,is.numeric)])[1,]
summary(all_fit)
all_fit=lm(data=sub_study,tv.spend~1+organic+organic.home+direct.home+paid.brand.sessions)
summary(all_fit)
all_fit=lm(data=sub_study,tv.spend~0+organic+organic.home+direct.home+paid.brand.sessions)
summary(all_fit)
coef(all_fit)
cor(sub_study[,sapply(sub_study,is.numeric)])[1,]
sapply(sub_study,is.numeric)]
sapply(sub_study,is.numeric)
cor(sub_study[,sapply(sub_study,is.numeric)])
cor(sub_study[,sapply(sub_study,is.numeric)])[5,]
cor(sub_study[,sapply(sub_study,is.numeric)])[4,]
cor(sub_study[,sapply(sub_study,is.numeric)])[5,]
coef(all_fit)
poly_fit=lm(data=sub_study,direct.home~tv.spend+tv.spend^2)
summary(poly_fit)
ctrl_arima_R2
tv_arima_R2
summary(poly_fit)
tv_arima=auto.arima(sub_study$direct.home,xreg=c(sub_study$tv.spend))
coef(tv_arima)
str(poly_fit)
poly_fit=lm(data=sub_study,paid.brand.sessions~tv.spend+tv.spend^2)
summary(poly_fit)
stl_obj=stl(ts(sub_study$organic, frequency = 2),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Seasonal Decomposition")
ctrl_arima=auto.arima(sub_study$organic)
coef(ctrl_arima)
ctrl_arima_fcast=forecast(ctrl_arima)
plot(ctrl_arima_fcast)
ctrl_arima_R2=round(cor(fitted(ctrl_arima_fcast),sub_study$organic)^2,2)
ctrl_arima_R2
tv_arima=auto.arima(sub_study$organic,xreg=c(sub_study$tv.spend))
coef(tv_arima)
tv_arima_fcast=forecast(tv_arima,xreg=c(sub_study$tv.spend))
plot(tv_arima_fcast)
tv_arima_R2=round(cor(fitted(tv_arima_fcast),sub_study$organic)^2,2)
tv_arima_R2
poly_fit=lm(data=sub_study,organic~tv.spend+tv.spend^2)
summary(poly_fit)
coef(tv_arima)
coefficients(poly_fit)
str(poly_fit)
round(cor(fitted(poly_fit),sub_study$organic)^2,2)
library(tidyr)
library(dplyr)
library(openxlsx)
library(lubridate)
library(ggplot2)
library(gridExtra)
library(forecast)
library(stats)
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",2))
tv_data$date=as.Date(as.character(tv_data$date),"%m/%d/%Y")+years(2000)
#Subsetting data
study_vars=c("date","tv.spend","organic","organic.home","direct.home","paid.brand.sessions")
study_cols=which(names(tv_data) %in% study_vars)
sub_study=na.omit(tv_data[,study_cols]  %>% arrange(desc(date)))
sub_study$paid.brand.sessions=as.numeric(as.character(sub_study$paid.brand.sessions))
stl_obj=stl(ts(sub_study$organic, frequency = 2),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Seasonal Decomposition")
ctrl_arima=auto.arima(sub_study$organic)
coef(ctrl_arima)
ctrl_arima_fcast=forecast(ctrl_arima)
plot(ctrl_arima_fcast)
ctrl_arima_R2=round(cor(fitted(ctrl_arima_fcast),sub_study$organic)^2,2)
ctrl_arima_R2
tv_arima=auto.arima(sub_study$organic,xreg=c(sub_study$tv.spend))
coef(tv_arima)
tv_arima_fcast=forecast(tv_arima,xreg=c(sub_study$tv.spend))
plot(tv_arima_fcast)
tv_arima_R2=round(cor(fitted(tv_arima_fcast),sub_study$organic)^2,2)
tv_arima_R2
big_poly_fit=lm(data=sub_study,organic~tv.spend+tv.spend^2+tv.spend^3+tv.spend^4)
summary(big_poly_fit)
stepwise_model=step(big_poly_fit,k=log(nrow(mtcars)))
summary(stepwise_model)
anova(big_poly_fit,stepwise_model, test="Chi")
coef(big_poly_fit)
poly_fit=lm(data=sub_study,organic~tv.spend+tv.spend^2)
summary(poly_fit)
big_poly_fit=lm(data=sub_study,organic~tv.spend+tv.spend^2+tv.spend^3+tv.spend^4)
summary(big_poly_fit)
stepwise_model=step(big_poly_fit,k=log(nrow(mtcars)))
summary(stepwise_model)
anova(big_poly_fit,stepwise_model, test="Chi")
stl_obj=stl(ts(sub_study$organic.home, frequency = 2),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Home Seasonal Decomposition")
tv_arima=auto.arima(sub_study$organic.home,xreg=c(sub_study$tv.spend))
coef(tv_arima)
tv_arima_fcast=forecast(tv_arima,xreg=c(sub_study$tv.spend))
plot(tv_arima_fcast)
tv_arima_R2=round(cor(fitted(tv_arima_fcast),sub_study$organic.home)^2,2)
tv_arima_R2
poly_fit=lm(data=sub_study,organic.home~tv.spend+tv.spend^2)
summary(poly_fit)
big_poly_fit=lm(data=sub_study,organic.home~tv.spend+tv.spend^2+tv.spend^3+tv.spend^4)
summary(big_poly_fit)
stepwise_model=step(big_poly_fit,k=log(nrow(mtcars)))
summary(stepwise_model)
anova(big_poly_fit,stepwise_model, test="Chi")
stl_obj=stl(ts(sub_study$direct.home, frequency = 2),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Direct Home Seasonal Decomposition")
#Arima model with TV spend
tv_arima=auto.arima(sub_study$direct.home,xreg=c(sub_study$tv.spend))
coef(tv_arima)
tv_arima_fcast=forecast(tv_arima,xreg=c(sub_study$tv.spend))
plot(tv_arima_fcast)
tv_arima_R2=round(cor(fitted(tv_arima_fcast),sub_study$organic.home)^2,2)
tv_arima_R2
poly_fit=lm(data=sub_study,direct.home~tv.spend+tv.spend^2)
summary(poly_fit)
big_poly_fit=lm(data=sub_study,direct.home~tv.spend+tv.spend^2+tv.spend^3+tv.spend^4)
summary(big_poly_fit)
stepwise_model=step(big_poly_fit,k=log(nrow(mtcars)))
summary(stepwise_model)
anova(big_poly_fit,stepwise_model, test="Chi")
stl_obj=stl(ts(sub_study$paid.brand.sessions, frequency = 2),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Paid Brand Seasonal Decomposition")
tv_arima=auto.arima(sub_study$paid.brand.sessions,xreg=c(sub_study$tv.spend))
plot(stl_obj)+title("Paid Brand Seasonal Decomposition")
stl_obj=stl(ts(sub_study$paid.brand.sessions, frequency = 2),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Paid Brand Seasonal Decomposition")
plot(stl_obj)+title("Direct Home Seasonal Decomposition")
stl_obj=stl(ts(sub_study$direct.home, frequency = 2),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Direct Home Seasonal Decomposition")
stl_obj=stl(ts(sub_study$paid.brand.sessions, frequency = 2),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Paid Brand Seasonal Decomposition")
tv_arima=auto.arima(sub_study$paid.brand.sessions,xreg=c(sub_study$tv.spend))
coef(tv_arima)
tv_arima_fcast=forecast(tv_arima,xreg=c(sub_study$tv.spend))
plot(tv_arima_fcast)
tv_arima_R2=round(cor(fitted(tv_arima_fcast),sub_study$paid.brand.sessions)^2,2)
tv_arima_R2
poly_fit=lm(data=sub_study,paid.brand.sessions~tv.spend+tv.spend^2)
summary(poly_fit)
big_poly_fit=lm(data=sub_study,direct.home~tv.spend+tv.spend^2+tv.spend^3+tv.spend^4)
summary(big_poly_fit)
stepwise_model=step(big_poly_fit,k=log(nrow(mtcars)))
summary(stepwise_model)
summary(big_poly_fit)
summary(big_poly_fit)
big_poly_fit=lm(data=sub_study,direct.home~tv.spend+tv.spend^2+tv.spend^3+tv.spend^4)
summary(big_poly_fit)
big_poly_fit=lm(data=sub_study,organic~tv.spend+tv.spend^2+tv.spend^3+tv.spend^4)
summary(big_poly_fit)
big_poly_fit=lm(data=sub_study,organic~tv.spend+I(tv.spend^2)+I(tv.spend^3)+I(tv.spend^4))
summary(big_poly_fit)
stepwise_model=step(big_poly_fit,k=log(nrow(mtcars)))
summary(stepwise_model)
stl_obj=stl(ts(sub_study$organic, frequency = 2),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Seasonal Decomposition")
tv_arima=auto.arima(sub_study$organic,xreg=c(sub_study$tv.spend))
coef(tv_arima)
tv_arima_fcast=forecast(tv_arima,xreg=c(sub_study$tv.spend))
plot(tv_arima_fcast)
tv_arima_R2=round(cor(fitted(tv_arima_fcast),sub_study$organic)^2,2)
tv_arima_R2
poly_fit=lm(data=sub_study,organic~tv.spend+tv.spend^2)
summary(poly_fit)
big_poly_fit=lm(data=sub_study,organic~tv.spend+I(tv.spend^2)+I(tv.spend^3)+I(tv.spend^4))
summary(big_poly_fit)
stepwise_model=step(big_poly_fit,k=log(nrow(mtcars)))
summary(stepwise_model)
big_poly_fit=lm(data=sub_study,organic.home~tv.spend+I(tv.spend^2)+I(tv.spend^3)+I(tv.spend^4))
summary(big_poly_fit)
poly_fit=lm(data=sub_study,organic.home~tv.spend+tv.spend^2)
summary(poly_fit)
summary(big_poly_fit)
stepwise_model=step(big_poly_fit,k=log(nrow(mtcars)))
summary(stepwise_model)
anova(big_poly_fit,stepwise_model, test="Chi")
poly_fit=lm(data=sub_study,paid.brand.sessions~tv.spend+tv.spend^2)
big_poly_fit=lm(data=sub_study,organic.home~tv.spend+I(tv.spend^2)+I(tv.spend^3)+I(tv.spend^4))
summary(big_poly_fit)
poly_fit=lm(data=sub_study,organic.home~tv.spend+tv.spend^2)
summary(poly_fit)
stepwise_model=step(big_poly_fit,k=log(nrow(mtcars)))
summary(stepwise_model)
poly_fit=lm(data=sub_study,direct.home~tv.spend+tv.spend^2)
summary(poly_fit)
big_poly_fit=lm(data=sub_study,direct.home~tv.spend+I(tv.spend^2)+I(tv.spend^3)+I(tv.spend^4))
summary(big_poly_fit)
stepwise_model=step(big_poly_fit,k=log(nrow(mtcars)))
summary(stepwise_model)
anova(big_poly_fit,stepwise_model, test="Chi")
poly_fit=lm(data=sub_study,paid.brand.sessions~tv.spend+tv.spend^2)
summary(poly_fit)
big_poly_fit=lm(data=sub_study,paid.brand.sessions~tv.spend+I(tv.spend^2)+I(tv.spend^3)+I(tv.spend^4))
summary(big_poly_fit)
stepwise_model=step(big_poly_fit,k=log(nrow(mtcars)))
summary(stepwise_model)
anova(big_poly_fit,stepwise_model, test="Chi")
stl_obj=stl(ts(sub_study$organic, frequency = 2),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Seasonal Decomposition")
tv_arima=auto.arima(sub_study$organic,xreg=c(sub_study$tv.spend))
coef(tv_arima)
tv_arima_R2=round(cor(fitted(tv_arima_fcast),sub_study$organic)^2,2)
tv_arima_R2
install.packages("pander")
?step
stl_obj=stl(ts(sub_study$paid.brand.sessions, frequency = 2),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Paid Brand Seasonal Decomposition")
View(sub_study)
study_vars=c("date","tv.spend","organic","organic.home","direct.home","paid.brand.sessions")
study_cols=which(names(tv_data) %in% study_vars)
sub_study=tv_data[,study_cols]  %>% arrange(desc(date))
View(sub_study)
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",2))
View(tv_data)
?read.xlsx
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",sheet=2,rows=95))
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",sheet=2))
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",sheet=2,rows=95))
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",sheet=2,rows=c(95)))
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",sheet=2,rows=c(1:95)))
View(tv_data)
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",sheet=2,rows=c(1:95),cols=c(1,3:48)))
View(tv_data)
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",sheet=2,rows=c(1:95),cols=c(1,3:26)))
View(tv_data)
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",sheet=2,rows=c(1:95),cols=c(1,3:18)))
View(tv_data)
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",sheet=2,rows=c(1:95),cols=c(1,3:20)))
View(tv_data)
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",sheet=2,rows=c(1:95),cols=c(1,4:20)))
View(tv_data)
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",sheet=2,rows=c(1:95),cols=c(1,4:20)))
tv_data$date=as.Date(as.character(tv_data$date),"%m/%d/%Y")+years(2000)
View(tv_data)
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",sheet=2,rows=c(1:95),cols=c(1,4:20)))
View(tv_data)
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",sheet=2,rows=c(1:95),cols=c(1,4:20)))
tv_data$date=as.Date(as.character(tv_data$date),"%m/%d/%Y")+years(2000)
which(is.na(tv_data$date))
na_ind=which(is.na(tv_data$date))
tv_data$date[na_ind]+weeks(1)
na_ind=which(is.na(tv_data$date))[1]
tv_data$date[na_ind]+weeks(1)
tv_data$date[na_ind]
tv_data$date[(na_ind-1)]+weeks(1)
for (ind in na_inds) tv_data$date[na_ind]=tv_data$date[(na_ind-1)]+weeks(1)
na_inds=which(is.na(tv_data$date))
for (ind in na_inds) tv_data$date[na_ind]=tv_data$date[(na_ind-1)]+weeks(1)
View(tv_data)
for (ind in na_inds) {tv_data$date[na_ind]=tv_data$date[(na_ind-1)]+weeks(1)}
View(tv_data)
for (ind in na_inds) {tv_data$date[ind]=tv_data$date[(ind-1)]+weeks(1)}
View(tv_data)
study_vars=c("date","tv.spend","organic","organic.home","direct.home","paid.brand.sessions")
study_cols=which(names(tv_data) %in% study_vars)
sub_study=tv_data[,study_cols]  %>% arrange(desc(date))
sub_study$paid.brand.sessions=as.numeric(as.character(sub_study$paid.brand.sessions))
View(sub_study)
sub_study=na.omit(tv_data[,study_cols]  %>% arrange(desc(date)))
View(sub_study)
sub_study=tv_data[,study_cols]  %>% arrange(desc(date))
View(sub_study)
sub_study=na.omit(tv_data[,study_cols]  %>% arrange(desc(date)))
View(sub_study)
View(sub_study)
sub_study=tv_data[,study_cols]  %>% arrange(desc(date))
sub_study[1,]=NULL
sub_study=sub_study[-1,]
View(sub_study)
study_vars=c("date","tv.spend","organic","organic.home","direct.home","paid.brand.sessions")
study_cols=which(names(tv_data) %in% study_vars)
sub_study=tv_data[,study_cols]  %>% arrange(desc(date))
sub_study=sub_study[-1,]
View(sub_study)
sub_study=na.omit(tv_data[,study_cols]  %>% arrange(desc(date)))
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",sheet=2,rows=c(1:95),cols=c(1,4:20)))
tv_data$date=as.Date(as.character(tv_data$date),"%m/%d/%Y")+years(2000)
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",sheet=2,rows=c(1:95),cols=c(1,4:20)))
tv_data$date=as.Date(as.character(tv_data$date),"%m/%d/%Y")+years(2000)
na_inds=which(is.na(tv_data$date))
for (ind in na_inds) {tv_data$date[ind]=tv_data$date[(ind-1)]+weeks(1)}
View(tv_data)
study_vars=c("date","tv.spend","organic","organic.home","direct.home","paid.brand.sessions")
study_cols=which(names(tv_data) %in% study_vars)
sub_study=na.omit(tv_data[,study_cols]  %>% arrange(desc(date)))
View(sub_study)
library(tidyr)
library(dplyr)
library(openxlsx)
library(lubridate)
library(ggplot2)
library(gridExtra)
library(forecast)
library(stats)
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",sheet=2,rows=c(1:95),cols=c(1,4:20)))
tv_data$date=as.Date(as.character(tv_data$date),"%m/%d/%Y")+years(2000)
na_inds=which(is.na(tv_data$date))
for (ind in na_inds) {tv_data$date[ind]=tv_data$date[(ind-1)]+weeks(1)}
#Subsetting data
study_vars=c("date","tv.spend","organic","organic.home","direct.home","paid.brand.sessions")
study_cols=which(names(tv_data) %in% study_vars)
sub_study=na.omit(tv_data[,study_cols]  %>% arrange(desc(date)))
sub_study=sub_study[-1,]
sub_study$paid.brand.sessions=as.numeric(as.character(sub_study$paid.brand.sessions))
poly_fit=lm(data=sub_study,organic~tv.spend+I(tv.spend^2))
plot(poly_fit)
tmp_df=data.frame(coef(poly_fit))
tmp_df
cor(fitted(poly_fit),sub_study$organic)
cor(fitted(poly_fit),sub_study$organic)^2
summary(poly_fit)
tmp_df=data.frame(coef(poly_fit),cor(fitted(poly_fit),sub_study$organic)^2)
tmp_df
tmp_df=data.frame(coef(poly_fit))
tmp_df=rbind(tmp_df,c("R2",cor(fitted(poly_fit),sub_study$organic)^2))
tmp_df
c("R2",cor(fitted(poly_fit),sub_study$organic)^2)
tmp_df=rbind(tmp_df,cor(fitted(poly_fit),sub_study$organic)^2)
tmp_df
tmp_df=data.frame(coef(poly_fit))
tmp_df=rbind(tmp_df,cor(fitted(poly_fit),sub_study$organic)^2)
tmp_df
pander(tmp_df)
library(pander)
pander(tmp_df)
names(tmp_df)
colnames(tmp_df)
rownames(tmp_df)
rownames(tmp_df)=c(rownames(tmp_df),"R2")
c(rownames(tmp_df),"R2")
rownames(tmp_df)[length(rownames(tmp_df))]="R2"
rownames(tmp_df)
tmp_df=data.frame(coef(poly_fit))
tmp_df=rbind(tmp_df,cor(fitted(poly_fit),sub_study$organic)^2)
rownames(tmp_df)[length(rownames(tmp_df))]="R2"
pander(tmp_df)
tmp_df=data.frame(round(coef(tv_arima),3))
tmp_df
tmp_df=rbind(tmp_df,tv_arima_R2)
rownames(tmp_df)[length(rownames(tmp_df))]="R2"
pander(tmp_df)
tmp_df=data.frame(round(coef(tv_arima),3))
tmp_df=rbind(tmp_df,tv_arima_R2)
rownames(tmp_df)[length(rownames(tmp_df))]="R2"
tmp_df
pander(tmp_df)
tmp_df=data.frame(round(coef(tv_arima),3))
tmp_df
tmp_df=rbind(tmp_df,tv_arima_R2)
tmp_df
rownames(tmp_df)[length(rownames(tmp_df))]="R2"
tmp_df
tmp_df
pander(tmp_df)
library(tidyr)
library(dplyr)
library(openxlsx)
library(lubridate)
library(ggplot2)
library(gridExtra)
library(forecast)
library(stats)
tv_data=tbl_df(read.xlsx("tvanalysis.xlsx",sheet=2,rows=c(1:95),cols=c(1,4:20)))
tv_data$date=as.Date(as.character(tv_data$date),"%m/%d/%Y")+years(2000)
na_inds=which(is.na(tv_data$date))
for (ind in na_inds) {tv_data$date[ind]=tv_data$date[(ind-1)]+weeks(1)}
#Subsetting data
study_vars=c("date","tv.spend","organic","organic.home","direct.home","paid.brand.sessions")
study_cols=which(names(tv_data) %in% study_vars)
sub_study=na.omit(tv_data[,study_cols]  %>% arrange(desc(date)))
sub_study=sub_study[-1,]
sub_study$paid.brand.sessions=as.numeric(as.character(sub_study$paid.brand.sessions))
####organic
stl_obj=stl(ts(sub_study$organic, frequency = 2),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Seasonal Decomposition")
stl_obj=stl(ts(sub_study$organic, frequency = 1),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Seasonal Decomposition")
stl_obj=stl(ts(sub_study$organic, frequency = 2),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Seasonal Decomposition")
stl_obj=stl(ts(sub_study$organic, frequency = 3),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Seasonal Decomposition")
stl_obj=stl(ts(sub_study$organic, frequency = 4),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Seasonal Decomposition")
stl_obj=stl(ts(sub_study$organic, frequency = 5),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Seasonal Decomposition")
stl_obj=stl(ts(sub_study$organic, frequency = 8),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Seasonal Decomposition")
stl_obj=stl(ts(sub_study$organic, frequency = 12),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Seasonal Decomposition")
stl_obj=stl(ts(sub_study$organic, frequency = 22),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Seasonal Decomposition")
stl_obj=stl(ts(sub_study$organic, frequency = 30),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Seasonal Decomposition")
stl_obj=stl(ts(sub_study$organic, frequency = 20),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Seasonal Decomposition")
stl_obj=stl(ts(sub_study$organic.home, frequency = 22),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Home Seasonal Decomposition")
stl_obj=stl(ts(sub_study$organic.home, frequency = 15),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Home Seasonal Decomposition")
stl_obj=stl(ts(sub_study$organic.home, frequency = 20),t.window=15,s.window="periodic",robust=TRUE)
plot(stl_obj)+title("Organic Home Seasonal Decomposition")
